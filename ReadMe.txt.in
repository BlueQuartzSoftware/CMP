Part of this code was written under United States Air Force Contract FA8650-07-D-5800